* dotfilez
  #+CAPTION: the_setup
  #+NAME:   setup.png
  [[./data/setup.png]]

  The setup of my ride has been steadily growing for almost 13 years now. In the
  vast sea of rc files, =/etc= config clauses, sensitive and public
  cryptographic key material, documents, default package lists and custom
  patches that I apply to the systems I run. I had to come up with a way to manage
  it all in some sane fashion.

  Dotfilez is an attempt to keep a configuration framework for my personal use
  online. You are welcome to modify it if you think it could be useful to you
  too.
  
* Public Keys
** GPG
   #+BEGIN_EXAMPLE
   -----BEGIN PGP PUBLIC KEY BLOCK-----

   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
   =MHwq
   -----END PGP PUBLIC KEY BLOCK-----
   #+END_EXAMPLE

** =authorized_keys=
   #+BEGIN_EXAMPLE
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCMbMY01S86OnaP7Q5H9kYHeBUdfTsZkGh1AwQC1VJIwXRHdldRigkFxCLR6QJkFVQt5ntruvXwBre1bDF04UveXLLtcq2P5iGZWgQtuVAsZ1DAENR5N+SMZY6DA/aPjg8tzv7lL09pwFkAxfVDWLEZXtcEuuCaaGbW9GH707MBnvMZn8rWD8MEEEflkrtpbTGxjrsubYqGOB9bL3PTEtrKBAhptaIHIhX7tcHBHoWVCNgt47U+zghg4VaJIj/c+TUY+1CUF/QWqfWl6En2JwLqKe8RhH4SqgWMt6WY5XDXurJHNjtlzSCbwf8jrXfSZq+63WLFxqdINyjqedkLSVhl zv@sigstkflt
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJZiX9CJyfQ2QYkm9Sh+BRoQVeM5UACdbOhf8PYfrwSC zv@sigstkflt
   #+END_EXAMPLE

* Workstation Setup

** Packages

*** Base
    #+BEGIN_SRC sh :results output :noweb no
      dnf list tmux vim-enhanced zsh
    #+END_SRC

*** Development
    #+BEGIN_SRC sh :results output :noweb no
      dnf list autoconf automake binutils bison clang cmake ctags flex \
          gcc gcc-c++ gdb git graphviz libtool make nasm openssl patch \
          pkgconf readline socat strace
    #+END_SRC

**** Python
     #+BEGIN_SRC sh :results output :noweb no
       dnf list python3 python3-devel python3-ipython \
           python3-epc python3-flake8 python3-importmagic python3-isort python3-mypy python3-yapf
     #+END_SRC

*** Desktop
    #+BEGIN_SRC sh :results output :noweb no
      dnf list adobe-source-code-pro-fonts avahi-tools bpftool bpftrace curl \
          dotnet elfutils emacs global global-ctags gnupg2 java-latest-openjdk jq \
          kernel-devel ltrace mtr nmap perf postgresql qemu ripgrep systemtap \
          valgrind weechat wget wine wireshark xsel z3
    #+END_SRC

**** Yubikey
     #+BEGIN_SRC sh :results output :noweb no
       dnf list gnupg2 gnupg2-smime pcsc-lite pcsc-tools ykclient ykpers yubikey-personalization-gui
     #+END_SRC

**** Remove "Install Package To Provide"
     Fedora contains a package to prompt the user if a missing command is typed into the shell, which this snippet disables.
     
     #+BEGIN_SRC sh :results output
       sudo dnf remove PackageKit-command-not-found
     #+END_SRC


** Link rc files
   #+NAME: link_all.sh
   #+BEGIN_SRC sh :var filename=(buffer-file-name) :results output
     #!/bin/sh
     ROOTDIR="$(dirname "$(readlink -f "${filename:-0}")")"

     set -euo pipefail

     symlink_at() {
         local src="$1"
         local dst="$2"

         if [[ -e "$dst" ]]; then
             printf "%s already exists\n" "$dst"
         elif [[ -d "$src" ]]; then
             ( set -x; ln -s -t "$dst" "$src" )
         elif [[ -f "$src" ]]; then
             ( set -x; ln -Ts "$src" "$dst" )
         else
             printf "%s is not a directory or file\n" "$src"
         fi
     }

     link_all() {
         if command -v "$1" 2>&1 > /dev/null; then
             shift

             while (( $# )); do
                 symlink_at "$1" "${HOME}/.$(basename "$1")"
                 shift
             done
         else
             printf "command '%s' not found\n" "$1"
         fi
     }

     link_all dig "$ROOTDIR/rc/digrc"
     link_all emacs "$ROOTDIR/rc/spacemacs" "$ROOTDIR/emacs.d" "$ROOTDIR/rc/gnus.el" "$ROOTDIR/rc/newsrc"
     link_all erl "$ROOTDIR/rc/erlang"
     link_all gdb "$ROOTDIR/rc/gdbinit"
     link_all git "$ROOTDIR/rc/gitignore" "$ROOTDIR/rc/gitconfig"
     link_all gpg "$ROOTDIR/rc/gnupg"
     link_all iex "$ROOTDIR/rc/iex"
     link_all node "$ROOTDIR/rc/npmrc" "$ROOTDIR/rc/babelrc"
     link_all psql "$ROOTDIR/rc/psqlrc"
     link_all rg "$ROOTDIR/rc/ripgreprc"
     link_all ruby "$ROOTDIR/rc/pryrc" "$ROOTDIR/rc/gemrc"
     link_all screen "$ROOTDIR/rc/screenrc"
     link_all screen "$ROOTDIR/rc/screenrc"
     link_all tmux "$ROOTDIR/rc/tmux.conf"
     link_all top "$ROOTDIR/rc/toprc"
     link_all vim "$ROOTDIR/rc/vim" "$ROOTDIR/rc/vimrc"
     link_all weechat "$ROOTDIR/rc/weechat"
     link_all wget "$ROOTDIR/rc/wgetrc"
     link_all zsh "$ROOTDIR/rc/zsh" "$ROOTDIR/rc/zshenv" "$ROOTDIR/rc/zshrc"
     link_all Xorg "$ROOTDIR/rc/Xsession" "$ROOTDIR/rc/Xdefaults"

     symlink_at "$ROOTDIR/rc/ssh" "$HOME/.ssh"
     symlink_at "$ROOTDIR/rc/editrc" "$HOME/.editrc"
     symlink_at "$ROOTDIR/rc/inputrc" "$HOME/.inputrc"
   #+END_SRC

*** Default shell
    #+BEGIN_SRC sh :results output
      sudo usermod  --shell "$(which zsh)" "$(whoami)"
    #+END_SRC

*** Gnome Keybindings
    #+BEGIN_SRC sh :results output
      gsettings set org.gnome.desktop.input-sources xkb-options "['caps:nocaps', 'ctrl:ralt_rctrl', 'ctrl:rctrl_ralt']"
    #+END_SRC

** org-protocol
   org-protocol intercepts calls from emacsclient to trigger custom actions without external dependencies. Only one protocol has to be configured with your external applications or the operating system, to trigger an arbitrary number of custom actions.

   #+BEGIN_SRC conf :tangle "~/.local/share/applications/org-protocol.desktop" :noweb no
     [Desktop Entry]
     Name=org-protocol
     Exec=emacsclient %u
     Type=Application
     Terminal=false
     Categories=System;
     MimeType=x-scheme-handler/org-protocol;
   #+END_SRC

   Afterwards, you must update the desktop database to ensure the =org-protocol=
   handler is installed.

   #+BEGIN_SRC sh :results silent
     update-desktop-database ~/.local/share/applications/
   #+END_SRC

** polkit
   polkit is an application-level toolkit for defining and handling the policy that allows unprivileged processes to speak to privileged processes: It is a framework for centralizing the decision making process with respect to granting access to privileged operations for unprivileged applications.

*** =libvirt=
    =libvirt= will complain about user-sessions hitting a root, I allow any user in =wheel= to do so anyway on my workstation.
    #+name: 80-libvirt.rules
    #+BEGIN_SRC javascript :tangle "/sudo::/etc/polkit-1/rules.d/80-libvirt.rules" :noweb no
      polkit.addRule(function(action, subject) {
        if (action.id == "org.libvirt.unix.manage" && subject.local && subject.active && subject.isInGroup("wheel")) {
          return polkit.Result.YES;
        }
      });
    #+END_SRC

** Python

*** IPython Config
    Rewrites the default =ipython_config.py= with my preferred defaults

    #+NAME: rewrite_ipython_config.awk
    #+BEGIN_SRC awk :results output
      #!/usr/bin/awk -f

      BEGIN {
          if (ARGC == 1) {
              ARGV[ARGC] = ENVIRON["HOME"] "/.ipython/profile_default/ipython_config.py"
              ARGC = ARGC + 1
          }
      }

      function set_value(new) {
          if ($2 == "=" && NF == 3) {
              sub("^#", "", $1)  # uncomment line
              printf "%s = %s\n", $1, new
              next
          }
      }

      $1 ~ /#c.TerminalIPythonApp.display_banner/ { set_value("False") }
      $1 ~ /#c.TerminalInteractiveShell.editing_mode/ { set_value("'vi'") }
      $1 ~ /#c.TerminalInteractiveShell.extra_open_editor_shortcuts/ { set_value("False") }
      $1 ~ /#c.InteractiveShell.autoindent/ { set_value("True") }
      $1 ~ /#c.InteractiveShell.autoawait/ { set_value("True") }

      { print }
    #+END_SRC

** =udev=
   =udev= is a device manager for the Linux kernel. As the successor of
   =devfsd= and =hotplug=, =udev= primarily manages device nodes in the =/dev=
   directory. At the same time, =udev= also handles all user space events
   raised while hardware devices are added into the system or removed from it,
   including firmware loading as required by certain devices.

*** Yubikey
    Add Yubikey access

    #+name: 70-u2f.rules
    #+BEGIN_SRC conf :tangle "/sudo::/etc/udev/rules.d/70-u2f.rules" :noweb yes
      # Yubico YubiKey

      KERNEL=="hidraw*", SUBSYSTEM=="hidraw", ATTRS{idVendor}=="1050", ATTRS{idProduct}=="0113|0114|0115|0116|0120|0200|0402|0403|0406|0407|0410", TAG+="uaccess"
    #+END_SRC

*** Wireshark (=usbmon=)

    #+name: 90-wireshark-usbmon.rules
    #+BEGIN_SRC conf :tangle "/sudo::/etc/udev/rules.d/90-wireshark-usbmon.rules" :noweb no
      # Wireshark

      SUBSYSTEM=="usbmon", GROUP="usbmon", MODE="640"
    #+END_SRC

** systemd
    
*** GnuPG
**** Socket-activated =dirmngr=
     #+BEGIN_SRC sh :results output
       systemctl --user enable dirmngr.socket
     #+END_SRC

**** Socket-activated =gpg-agent= with SSH support 
     #+BEGIN_SRC sh :results output
       systemctl --user enable gpg-agent.socket gpg-agent-ssh.socket
     #+END_SRC
     
*** =coredump=
    I've never ended up with 20 gigabytes of coredump files, but I'd like to avoid it.
    #+name: coredump.conf
    #+BEGIN_SRC conf :tangle "/sudo::/etc/systemd/coredump.conf" :noweb no
      # See coredump.conf(5) for details.

      [Coredump]
      #Storage=external
      Compress=yes
      #ProcessSizeMax=2G
      #ExternalSizeMax=2G
      JournalSizeMax=767M
      MaxUse=1G
      #KeepFree=
    #+END_SRC

** gnome-terminal
   I prefer a smaller padding on my gnome terminal.

   #+name: gtk.css
   #+BEGIN_SRC css :tangle "~/.config/gtk-3.0/gtk.css" :noweb no
     VteTerminal,
     TerminalScreen,
     vte-terminal {
       /* XXX: Don't attempt to change this to padding: 5px 0 5px 5px */
       padding-bottom: 0px;
       padding-top: 5px;
       padding-left: 5px;
       padding-right: 5px;
     }

     /* shrink headerbars */
     headerbar {
       min-height: 0px;
       padding-left: 0px; /* same as childrens vertical margins for nicer proportions */
       padding-right: 0px;
     }

     headerbar entry,
     headerbar spinbutton,
     headerbar button,
     headerbar separator {
       margin-top: 0px; /* same as headerbar side padding for nicer proportions */
       margin-bottom: 0px;
     }

     /* shrink ssd titlebars */
     .default-decoration {
       min-height: 0; /* let the entry and button drive the titlebar size */
       padding: 0px;
     }

     .default-decoration .titlebutton {
       min-height: 0px; /* tweak these two props to reduce button size */
       min-width: 0px;
     }

     window.ssd headerbar.titlebar,
     window.ssd headerbar.titlebar button.titlebutton
     {
       padding-top: 0px;
       padding-bottom: 0px;
       min-height: 0;
     }
   #+END_SRC

   You can also remove the ridiculously huge headerbar in Gnome 3.32+

   #+BEGIN_SRC sh :results silent
     gsettings set org.gnome.Terminal.Legacy.Settings headerbar false
   #+END_SRC

** NetworkManager
   NetworkManager is a program for providing detection and configuration for systems to automatically connect to network.

   I use a local resolver (=dnsmasq=) instead of those provided by DHCP.

*** Enable =dnsmasq=
**** =NetworkManager.conf=
     You must ensure NetworkManager globally enables local resolver =dnsmasq=
     #+NAME: NetworkManager.conf
     #+BEGIN_SRC conf
       [main]
       dns=dnsmasq
     #+END_SRC

**** =dnsmasq.conf=
     This will tack on these servers to the list recieved by DHCP.
     #+NAME: server.conf
     #+BEGIN_SRC conf :tangle "/sudo::/etc/NetworkManager/dnsmasq.d/server.conf" :noweb no
       server=2606:4700:4700::1111
       server=1.1.1.1
       server=2001:4860:4860::8888
       server=8.8.8.8
     #+END_SRC

* Backup
** Thunderbird
   Thunderbird provides an excellent RSS reader and I keep a list of the feeds which I consume in =thunderbird/zv-feeds.opml=.
   
** Gnome Keybindings
*** Backup

    #+NAME: keybindings
    #+BEGIN_SRC sh :results file :file-ext sh :output-dir backup
      local schema
      local key
      local value
      schema="org.gnome.desktop.wm.keybindings"
      for key in $(gsettings list-keys "$schema"); do
          value="$(gsettings get "$schema" "$key")"

          if [[ "$?" -eq 0 && ! -z "$value" ]]; then
              printf "gsettings set %s %s %s\n" "$schema" "$key" "$value"
          fi
      done
    #+END_SRC

*** Restore

    #+BEGIN_SRC sh :results output
      gsettings set org.gnome.desktop.input-sources xkb-options "['caps:nocaps', 'ctrl:ralt_rctrl', 'ctrl:rctrl_ralt']"
    #+END_SRC

** =gnome-terminal=
    
*** Backup
    #+NAME: gnome-terminal-themes
    #+BEGIN_SRC sh :results file :file-ext dconf :output-dir backup
      dconf dump /org/gnome/terminal/
    #+END_SRC

    #+RESULTS: gnome-terminal-themes
    [[file:backup/gnome-terminal-themes.dconf]]

** GnuPG
*** Backup
    #+BEGIN_SRC sh :results output :var destination="backup"
      cp ~/.gnupg/pubring.gpg "$destination" && echo "Copied pubring.gpg to $destination"
    #+END_SRC

    #+RESULTS:
    : Copied pubring.gpg to backup

    #+NAME: owner_trust
    #+BEGIN_SRC sh :results file :file-ext lst :output-dir backup
      gpg --export-ownertrust
    #+END_SRC

    #+RESULTS: owner_trust
    [[file:backup/owner_trust.lst]]

*** Restore
    #+BEGIN_SRC sh :results output
      gpg --import-options restore --import backup/pubring.gpg
      gpg --import-ownertrust owner_trust.lst
    #+END_SRC

** rsync
   #+NAME: rsync-include.lst
   #+BEGIN_EXAMPLE
~/.aws/*
~/.bash_history
~/.kube
~/.local/share/keyrings
~/.bash_history
~/.zsh_history
~/Backup
~/Books
~/Development/dotfilez
~/Development/zv.github.io
~/zv.github.io
~/Documents
~/Music
~/Pictures
   #+END_EXAMPLE
